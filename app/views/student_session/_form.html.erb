Username: <input type="text" id="user" value="Username">
<p onclick = "check()">Submit</p>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script language="JavaScript" type="text/javascript" src="http://localhost:3000/assets/rsa.self-9c9e3db64700d9507544d0cf380a7b7d5e9cefdbc643749ba25cf8324ec23525.js?body=1"></script>
<script language="JavaScript" type="text/javascript" src="http://localhost:3000/assets/BigInteger.self-3449fe08e0a1454ccf5a023320cd523f3180d439c1d8ccb7639807df7cdf53b4.js?body=1" ></script>
<script>
	function check() {
		var user = document.getElementById("user").value;
		var data = {username: user};
		var x1;
		var data_returned;
		$.ajax({
            url: '/communicate',
            type: 'POST',
            dataType: 'text',
			data: data,
			async: false,
			success: function (data_returned_by_server) {
				data_returned = data_returned_by_server;
            	
        	},
        	error: function (result) {
            	alert('error');
        	}
			
            });
            
            if (!(localStorage.getItem(user+"d")))
            {
            	alert ("No Such User");
            	location.reload(false);
            }
            
            x1 = bigInt(data_returned).modPow(bigInt(localStorage.getItem(user+"d")),bigInt(localStorage.getItem(user+"n")))
            var x2 = x1.toString(16);
			var y2 = x2.substring(64);
			x2 = x2.substring(0,64);
			var r1 = bigInt(y2,16).xor(bigInt(SHA256(x2),16)).toString(16);
			var message = bigInt(x2,16).xor(bigInt(SHA256(r1),16));
			var comm_key_padded = message.toString(16);			
			var comm_key = comm_key_padded.substring(0, 32) + comm_key_padded.substring(42);
			var checker_message = comm_key_padded.substring(32, 42);
			if (checker_message == "1001001001")
			{
				sessionStorage.setItem(user + "comm_key", comm_key);
				var id;
				data = {email: user};
				$.ajax({
            	url: '/studentlogin',
            	type: 'POST',
				data: data,
				async: false,
        		});
        	}
        	else
        	{
        		alert("Incorrect Username");
        		location.reload(true)
        	}
        }
        
            
</script>

