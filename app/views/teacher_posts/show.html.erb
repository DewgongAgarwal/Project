<p id="notice"><%= notice %></p>

<% @categories.each do |ca| %>
<br>

<h3><%= ca.name %></h3>
<%= link_to 'New Post', teacher_post_new_path(@teacher.id, ca) %>
<br><br>
<% case ca.id %>
<% when 1%>

	<% @post = TeacherPost.where(teacher_id: @teacher, category: 1)%>
	<% if @post.length == 0 %>
		<%= "Not Posted" %>
	<% else%>
		<p onclick = "reveal(<%=post.id%>)">Click to View Data</p>
		<% status = Status.where(id: @post[0].status) %>
		<%= status %>
		<% if @post[0].sign_id %>
					<td><%= link_to "Check", check_path(@post[0].id, 2, @teacher.id)%></td>
					<%end%>
	<%end%>

	<br><br>

<% when 2 %>
<table>
	<% @profile.each do |prof| %> 
	<tr>
		<% @post = TeacherPost.where(teacher_id: @teacher, category: 2, subcategory: prof.id)%>
		<td><%= prof.name %></td>
		<% if @post.length == 0 %>
			<td> <%= "Not Posted" %> </td>
		<% else %>
			<td onclick = "reveal(<%=post.id%>)">Click to View Data</td>
			<% status = Status.where(id: @post[0].status) %>
			<td><%= status[0].name %></td>
			<% if @post[0].sign_id %>
					<td><%= link_to "Check", check_path(@post[0].id, 2, @teacher.id)%></td>
					<%end%>	 	 
		<% end %>
			</tr>
			<% end %>
			
		</table>
			<br><br>
	<br><br>
	<% end %>
<% end %>
<%= link_to 'Back', teacher_path(@teacher) %>

<script>

alert = function(){};

function reveal(a)
{
	var data_returned;
	var data_to_sent = {post_id: a, type: 2};
		$.ajax({
            	url: '/give_numbers',
            	type: 'POST',
            	datatype: 'text',
				data: data_to_sent,
				async: false,
				success: function (data_returned_by_server) {
				
				data_returned = data_returned_by_server;
            	
        		},
        		error: function (result) {
            		console.log('error');
        		}
			
            });
            
            var i;
            var sum = 0;
            for (i = 1; i < 6; i++)
            {
            	sum += data_returned[i];
            }
            
            confirm(cryptico.decryptAESCBC(data_returned[0], SHA256(sum.toString(16))));            
				
	
}
</script>
